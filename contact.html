<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description"
    content="Jamie Skinner is a full stack developer from Austin Texas.
    During his tenure at IBM Design he won two international design awards and worked on some of IBM's most high profile strategic projects.">
  <title>Contact - Jamie's Portfolio</title>
  <link rel="stylesheet" type="text/css" href="styles.css" />
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-48698531-6"></script>
  <script src="scripts/googleAnalytics.js"></script>
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
</head>

<body>
  <div id="wrapper">
    <nav class="navigation">
      <ul>
        <li><a href="/">Home</a></li>
        <li><a href="/about.html">About</a></li>
        <li><a href="/contact.html">Contact</a></li>
        <li><a href="/faq.html">FAQs</a></li>
        <li><a href="/work">Work</a></li>
        <li>
          <input id="crazy-mode" type="checkbox" name="crazy">Make things weird
        </li>
      </ul>
    </nav>
    <div class="intro">
      <h1 class="title">Contact</h1>
    </div>
    <p>Shoot me a message!</p>
    <form class="contact-form" id="contact-form">
      <label for="name">Your Name:</label>
      <input id="name" type="text" name="name" placeholder="Jeff Bezos">
      <label for="email">Your Email:</label>
      <input id="email" type="email" name="_replyto" placeholder="jeff@amazon.com">
      <label for="subject">Subject:</label>
      <input id="subject" type="subject" name="_replyto" placeholder="Help!">
      <label for="message">Message:</label>
      <textarea id="message" name="message" placeholder="Please Jamie! We need you"></textarea>
      <input type="hidden" name="_honeypot" value="">
      <div class="g-recaptcha" data-sitekey="6Lf8z9sUAAAAAPsdlc7r1ULgGTKNPHf37cv-r3Gl"></div>
      <button type="submit">SEND</button>
    </form>

    <script src="./scripts/cc.js"></script>
    <script>
      let form = document.getElementById('contact-form')


      form.addEventListener('submit', (e) => {
        e.preventDefault()

        let emailElement = document.getElementById('email')
        let messageElement = document.getElementById('message')
        let nameElement = document.getElementById('name')
        let subjectElement = document.getElementById('subject')
        let recaptcha = grecaptcha.getResponse()
        let body = {
          email: sanitize(emailElement.value),
          subject: sanitize(subjectElement.value),
          name: sanitize(nameElement.value),
          message: sanitize(messageElement.value),
          recaptcha: recaptcha
        }

        console.log(body)

        if (!recaptcha) return alert('Please complete the recapthca');
        else {
          fetch('/api/email', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(body)
          }).then(function (e) {
            alert('Message sent')
            emailElement.value = ''
            messageElement.value = ''
            nameElement.value = ''
            subjectElement.value = ''
          }).catch((err) => {
            alert('OOPS! There was an error. ')
            console.log('error', err)
          })
        }
      })

      // sanitize helper
      function sanitize(string) {
        const map = {
          '&': '&amp;',
          '<': '&lt;',
          '>': '&gt;',
          '"': '&quot;',
          "'": '&#x27;',
          "/": '&#x2F;',
        };
        const reg = /[&<>"'/]/ig;
        return string.replace(reg, (match) => (map[match]));
      }
    </script>
</body>

</html>